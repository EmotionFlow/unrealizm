var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var g=a[f];if(b.call(c,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var multiFileUploader=null;$.ajaxSetup({cache:!1});
(function(){var a=window.jQuery;a.paste=function(a){"undefined"!==typeof console&&null!==console&&console.log("DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead.");return f.mountNonInputable(a)._container};a.fn.pastableNonInputable=function(){var b;var e=0;for(b=this.length;e<b;e++){var c=this[e];c._pastable||a(c).is("textarea, input:text, [contenteditable]")||(f.mountNonInputable(c),c._pastable=!0)}return this};a.fn.pastableTextarea=function(){var b;var e=0;for(b=
this.length;e<b;e++){var c=this[e];c._pastable||a(c).is(":not(textarea, input:text)")||(f.mountTextarea(c),c._pastable=!0)}return this};a.fn.pastableContenteditable=function(){var b;var e=0;for(b=this.length;e<b;e++){var c=this[e];c._pastable||a(c).is(":not([contenteditable])")||(f.mountContenteditable(c),c._pastable=!0)}return this};var b=function(a,b){var c,e,h;null==b&&(b=512);if(!(c=a.match(/^data:([^;]+);base64,(.+)$/)))return null;a=c[1];var m=atob(c[2]);c=[];for(h=0;h<m.length;){var l=m.slice(h,
h+b);var d=Array(l.length);for(e=0;e<l.length;)d[e]=l.charCodeAt(e),e++;d=new Uint8Array(d);c.push(d);h+=b}return new Blob(c,{type:a})};var c=function(){return a(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden",opacity:1E-17})};var d=function(c,b){var e=c.nodeName.toLowerCase();if("area"===e){b=c.parentNode;e=b.name;if(!c.href||!e||"map"!==b.nodeName.toLowerCase())return!1;c=a("img[usemap='#"+
e+"']");return 0<c.length&&c.is(":visible")}/^(input|select|textarea|button|object)$/.test(e)?(e=!c.disabled)&&(b=a(c).closest("fieldset")[0])&&(e=!b.disabled):e="a"===e?c.href||b:b;return(e=e||a(c).is("[contenteditable]"))&&a(c).is(":visible")};var f=function(){function f(c,b){this._container=c;this._target=b;this._container=a(this._container);this._target=a(this._target).addClass("pastable");this._container.on("paste",function(a){return function(c){var b,e,f;a.originalEvent=null!==c.originalEvent?
c.originalEvent:null;a._paste_event_fired=!0;if(null!=(null!=(b=c.originalEvent)?b.clipboardData:void 0)){var d=c.originalEvent.clipboardData;if(d.items){var h=null;a.originalEvent.pastedTypes=[];var k=d.items;var g=0;for(e=k.length;g<e;g++)b=k[g],b.type.match(/^text\/(plain|rtf|html)/)&&a.originalEvent.pastedTypes.push(b.type);var n=d.items;g=e=0;for(k=n.length;e<k;g=++e){b=n[g];if(b.type.match(/^image\//)){d=new FileReader;d.onload=function(b){return a._handleImage(b.target.result,a.originalEvent,
h)};try{d.readAsDataURL(b.getAsFile())}catch(v){}c.preventDefault();break}if("text/plain"===b.type){if(0===g&&1<d.items.length&&d.items[1].type.match(/^image\//)){var r=!0;var t=d.items[1].type}b.getAsString(function(b){return r?(h=b,a._target.trigger("pasteText",{text:b,isFilename:!0,fileType:t,originalEvent:a.originalEvent})):a._target.trigger("pasteText",{text:b,originalEvent:a.originalEvent})})}"text/rtf"===b.type&&b.getAsString(function(b){return a._target.trigger("pasteTextRich",{text:b,originalEvent:a.originalEvent})});
"text/html"===b.type&&b.getAsString(function(b){return a._target.trigger("pasteTextHtml",{text:b,originalEvent:a.originalEvent})})}}else{if(-1!==Array.prototype.indexOf.call(d.types,"text/plain")){var p=d.getData("Text");setTimeout(function(){return a._target.trigger("pasteText",{text:p,originalEvent:a.originalEvent})},1)}a._checkImagesInContainer(function(b){return a._handleImage(b,a.originalEvent)})}}if(d=window.clipboardData)if(null!=(f=p=d.getData("Text"))&&f.length)setTimeout(function(){a._target.trigger("pasteText",
{text:p,originalEvent:a.originalEvent});return a._target.trigger("_pasteCheckContainerDone")},1);else{d=d.files;f=0;for(b=d.length;f<b;f++)c=d[f],a._handleImage(URL.createObjectURL(c),a.originalEvent);a._checkImagesInContainer(function(a){})}return null}}(this))}f.prototype._target=null;f.prototype._container=null;f.mountNonInputable=function(b){var e=new f(c().appendTo(b),b);a(b).on("click",function(a){return function(a){if(!d(a.target,!1)&&!window.getSelection().toString())return e._container.focus()}}(this));
e._container.on("focus",function(c){return function(){return a(b).addClass("pastable-focus")}}(this));return e._container.on("blur",function(c){return function(){return a(b).removeClass("pastable-focus")}}(this))};f.mountTextarea=function(b){var e,d;if("undefined"!==typeof DataTransfer&&null!==DataTransfer&&DataTransfer.prototype&&null!=(e=Object.getOwnPropertyDescriptor)&&null!=(d=e.call(Object,DataTransfer.prototype,"items"))&&d.get)return this.mountContenteditable(b);var h=new f(c().insertBefore(b),
b);var g=!1;a(b).on("keyup",function(a){var b;if(17===(b=a.keyCode)||224===b)g=!1;return null});a(b).on("keydown",function(c){var e;if(17===(e=c.keyCode)||224===e)g=!0;null!=c.ctrlKey&&null!=c.metaKey&&(g=c.ctrlKey||c.metaKey);g&&86===c.keyCode&&(h._textarea_focus_stolen=!0,h._container.focus(),h._paste_event_fired=!1,setTimeout(function(c){return function(){if(!h._paste_event_fired)return a(b).focus(),h._textarea_focus_stolen=!1}}(this),1));return null});a(b).on("paste",function(a){return function(){}}(this));
a(b).on("focus",function(c){return function(){if(!h._textarea_focus_stolen)return a(b).addClass("pastable-focus")}}(this));a(b).on("blur",function(c){return function(){if(!h._textarea_focus_stolen)return a(b).removeClass("pastable-focus")}}(this));a(h._target).on("_pasteCheckContainerDone",function(c){return function(){a(b).focus();return h._textarea_focus_stolen=!1}}(this));return a(h._target).on("pasteText",function(c){return function(c,e){var d=a(b).prop("selectionStart");var f=a(b).prop("selectionEnd");
c=a(b).val();a(b).val(""+c.slice(0,d)+e.text+c.slice(f));a(b)[0].setSelectionRange(d+e.text.length,d+e.text.length);return a(b).trigger("change")}}(this))};f.mountContenteditable=function(b){new f(b,b);a(b).on("focus",function(c){return function(){return a(b).addClass("pastable-focus")}}(this));return a(b).on("blur",function(c){return function(){return a(b).removeClass("pastable-focus")}}(this))};f.prototype._handleImage=function(a,c,d){if(a.match(/^webkit\-fake\-url:\/\//))return this._target.trigger("pasteImageError",
{message:"You are trying to paste an image in Safari, however we are unable to retieve its data."});this._target.trigger("pasteImageStart");var e=new Image;e.crossOrigin="anonymous";e.onload=function(a){return function(){var f=document.createElement("canvas");f.width=e.width;f.height=e.height;f.getContext("2d").drawImage(e,0,0,f.width,f.height);var g=null;try{g=f.toDataURL("image/png");var h=b(g)}catch(u){}g&&a._target.trigger("pasteImage",{blob:h,dataURL:g,width:e.width,height:e.height,originalEvent:c,
name:d});return a._target.trigger("pasteImageEnd")}}(this);e.onerror=function(b){return function(){b._target.trigger("pasteImageError",{message:"Failed to get image from: "+a,url:a});return b._target.trigger("pasteImageEnd")}}(this);return e.src=a};f.prototype._checkImagesInContainer=function(b){var c;var d=Math.floor(1E3*Math.random());var e=this._container.find("img");var f=0;for(c=e.length;f<c;f++){var g=e[f];g["_paste_marked_"+d]=!0}return setTimeout(function(c){return function(){var e;var f=
c._container.find("img");var h=0;for(e=f.length;h<e;h++)g=f[h],g["_paste_marked_"+d]||(b(g.src),a(g).remove());return c._target.trigger("_pasteCheckContainerDone")}}(this),1)};return f}()}).call(this);function DispDescCharNum(){var a=200-$("#EditDescription").val().length;$("#DescriptionCharNum").html(a)}function DispTagListCharNum(){var a=100-$("#EditTagList").val().length;$("#EditTagListCharNum").html(a)}
function OnChangeTab(a){setCookie("MOD",a);window.location.href=0==a?"/UploadFilePcV.jsp":"/UploadPastePcV.jsp"}function setTweetSetting(a){setLocalStrage("upload_tweet",a)}function getTweetSetting(){return getLocalStrage("upload_tweet")?!0:!1}function setTweetImageSetting(a){setLocalStrage("upload_tweet_image",a)}function getTweetImageSetting(){return getLocalStrage("upload_tweet_image")?!0:!1}function setLastCategorySetting(a){setLocalStrage("last_category",a)}
function getLastCategorySetting(){return getLocalStrage("last_category")}function checkPublishDatetime(a,b,c,d,f){d=void 0===d?null:d;return c&&d===a&&(void 0===f?null:f)===b?!0:""==a||""==b?(dateTimeEmptyMsg(),!1):(!c||c&&d!==a)&&Date.parse(a)<Date.now()?(dateTimePastMsg(),!1):Date.parse(a)>Date.parse(b)?(dateTimeReverseMsg(),!1):!0}
function updateTweetButton(){$("#OptionTweet").prop("checked")?($("#ImageSwitch .OptionLabel").removeClass("disabled"),$("#ImageSwitch .onoffswitch").removeClass("disabled"),$("#OptionImage:checkbox").prop("disabled",!1)):($("#ImageSwitch .OptionLabel").addClass("disabled"),$("#ImageSwitch .onoffswitch").addClass("disabled"),$("#OptionImage:checkbox").prop("disabled",!0))}
function initStartDatetime(a){var b=new Date;b.setMinutes(30*Math.floor((b.getMinutes()+45)/30));$("#EditTimeLimitedStart").flatpickr({enableTime:!0,dateFormat:"Y/m/d H:i",time_24hr:!0,minuteIncrement:30,defaultDate:a})}function initEndDatetime(a){var b=new Date;b.setMinutes(30*Math.floor((b.getMinutes()+45)/30));$("#EditTimeLimitedEnd").flatpickr({enableTime:!0,dateFormat:"Y/m/d H:i",time_24hr:!0,minuteIncrement:30,defaultDate:a})}
function updatePublish(){var a=parseInt($("#EditPublish").val(),10),b=[$("#ItemTwitterList"),$("#ItemPassword"),$("#ItemTimeLimited")];if(4==a||10==a||11==a){var c=null,d=null;switch(a){case 4:d=$("#ItemPassword");break;case 10:d=$("#ItemTwitterList");break;case 11:d=$("#ItemTimeLimited")}for(var f=0;f<b.length;f++){var g=b[f];if(g.is(":visible")){c=g;break}}null==c?d.slideDown(300):c.slideUp(300,function(){d.delay(150).slideDown(300)});11==a&&$.each(["#EditTimeLimitedStart","#EditTimeLimitedEnd"],
function(a,b){0>$(b)[0].classList.value.indexOf("flatpickr-input")&&(a=new Date,a.setMinutes(30*Math.floor((a.getMinutes()+45)/30)),$(b).flatpickr({enableTime:!0,dateFormat:"Y/m/d H:i",time_24hr:!0,minuteIncrement:30,minDate:a}))})}else for(f=0;f<b.length;f++)g=b[f],g.is(":visible")&&g.slideUp(300)}
function initUploadFile(){$("#OptionTweet").prop("checked",getTweetSetting());$("#OptionImage").prop("checked",getTweetImageSetting());var a=getLastCategorySetting();$("#EditCategory option").each(function(){console.log($(this).val());$(this).val()==a&&$("#EditCategory").val(a)});updateTweetButton();multiFileUploader=new qq.FineUploader({element:document.getElementById("file-drop-area"),autoUpload:!1,button:document.getElementById("TimeLineAddImage"),maxConnections:1,validation:{allowedExtensions:["jpeg",
"jpg","gif","png"],itemLimit:200,sizeLimit:2E7,stopOnFirstInvalidFile:!1},retry:{enableAuto:!1},callbacks:{onUpload:function(a,c){this.first_file?(this.first_file=!1,this.setEndpoint("/f/UploadFileFirstF.jsp",a),console.log("UploadFileFirstF")):(this.setEndpoint("/f/UploadFileAppendF.jsp",a),console.log("UploadFileAppendF"));this.setParams({UID:this.user_id,IID:this.illust_id,REC:this.recent},a)},onAllComplete:function(a,c){console.log("onAllComplete",a,c,this.tweet);1==this.tweet?$.ajax({type:"post",
data:{UID:this.user_id,IID:this.illust_id,IMG:this.tweet_image},url:"/f/UploadFileTweetF.jsp",dataType:"json",success:function(a){console.log("UploadFileTweetF");completeMsg();setTimeout(function(){location.href="/MyHomePcV.jsp"},1E3)}}):(completeMsg(),setTimeout(function(){location.href="/MyHomePcV.jsp"},1E3))},onValidate:function(a){var b=this.getSubmittedSize(),d=this.getSubmittedNum();this.showTotalSize(b,d);b+=a.size;if(b>this.total_size)return!1;this.showTotalSize(b,d+1)},onStatusChange:function(a,
c,d){this.showTotalSize(this.getSubmittedSize(),this.getSubmittedNum())}}});multiFileUploader.getSubmittedNum=function(){return this.getUploads({status:qq.status.SUBMITTED}).length};multiFileUploader.getSubmittedSize=function(){var a=this.getUploads({status:qq.status.SUBMITTED}),c=0;$.each(a,function(){c+=this.size});return c};multiFileUploader.showTotalSize=function(a,c){var b="(jpeg|png|gif, 200files, total 50MByte)";0<a&&(b="("+c+"/200,  "+Math.ceil((multiFileUploader.total_size-a)/1024)+" KByte)",
$("#TimeLineAddImage").removeClass("Light"),completeAddFile());$("#TotalSize").html(b)};multiFileUploader.total_size=52428800}
function UploadFile(a){if(multiFileUploader&&!(0>=multiFileUploader.getSubmittedNum())){var b=$("#EditCategory").val(),c=$.trim($("#EditDescription").val());c=c.substr(0,200);var d=$.trim($("#EditTagList").val());d=d.substr(0,100);var f=$("#EditPublish").val(),g=$("#EditPassword").val(),e=$("#OptionRecent").prop("checked")?1:0,k=$("#OptionTweet").prop("checked")?1:0,n=$("#OptionImage").prop("checked")?1:0,h=null,m=$("#EditTimeLimitedStart").val(),l=$("#EditTimeLimitedEnd").val();10==f&&(h=$("#EditTwitterList").val());
if(11!=f||checkPublishDatetime(m,l,!1))setTweetSetting($("#OptionTweet").prop("checked")),setTweetImageSetting($("#OptionImage").prop("checked")),setLastCategorySetting(b),99==f&&(e=2,k=0),startMsg(),console.log("start upload"),$.ajaxSingle({type:"post",data:{UID:a,CAT:b,DES:c,TAG:d,PID:f,PPW:g,PLD:h,PST:m,PED:l},url:"/f/UploadFileRefTwitterF.jsp",dataType:"json",success:function(b){console.log("UploadFileReferenceF");b&&b.content_id&&(0<b.content_id?(multiFileUploader.first_file=!0,multiFileUploader.user_id=
a,multiFileUploader.illust_id=b.content_id,multiFileUploader.recent=e,multiFileUploader.tweet=k,multiFileUploader.tweet_image=n,multiFileUploader.uploadStoredFiles()):errorMsg())}})}}var g_strPasteMsg="";
function initUploadPaste(){$("#OptionTweet").prop("checked",getTweetSetting());$("#OptionImage").prop("checked",getTweetImageSetting());var a=getLastCategorySetting();$("#EditCategory option").each(function(){console.log($(this).val());$(this).val()==a&&$("#EditCategory").val(a)});updateTweetButton();g_strPasteMsg=$("#TimeLineAddImage").html();$("#TimeLineAddImage").pastableContenteditable();$("#TimeLineAddImage").on("pasteImage",function(a,c){10>$(".InputFile").length&&(a=createPasteElm(c.dataURL),
$("#PasteZone").append(a),$("#TimeLineAddImage").html(g_strPasteMsg));updatePasteNum()}).on("pasteImageError",function(a,c){c.url&&alert("error data : "+c.url)}).on("pasteText",function(a,c){$("#TimeLineAddImage").html(g_strPasteMsg)})}
function createPasteElm(a){var b=$("<div />").addClass("InputFile"),c=$("<div />").addClass("DeletePaste").html('<i class="fas fa-times"></i>').on("click",function(){$(this).parent().remove();updatePasteNum()});a=$("<img />").addClass("imgView").attr("src",a);b.append(c).append(a);return b}
function createPasteListItem(a,b){b=$("<li />").addClass("InputFile").attr("id",b);var c=$("<div />").addClass("DeletePaste").html('<i class="fas fa-times"></i>').on("click",function(){$(this).parent().remove();updatePasteNum()});a=$("<img />").addClass("imgView").attr("src",a);b.append(c).append(a);return b}
function createPasteListItem(a,b){b=$("<li />").addClass("InputFile").attr("id",b);var c=$("<div />").addClass("DeletePaste").html('<i class="fas fa-times"></i>').on("click",function(){$(this).parent().remove();updatePasteNum()});a=$("<img />").addClass("imgView").attr("src",a);b.append(c).append(a);return b}
function initPasteElm(a){a.on("pasteImage",function(a,c){$(".OrgMessage",this).hide();$(".imgView",this).attr("src",c.dataURL).show()}).on("pasteImageError",function(a,c){c.url&&alert("error data : "+c.url)}).on("pasteText",function(a,c){})}function updatePasteNum(){strTotal="("+$(".InputFile").length+"/10)";$("#TotalSize").html(strTotal)}
function UploadPaste(a){var b=0;$(".imgView").each(function(){0<$.trim($(this).attr("src")).length&&b++});console.log(b);if(!(0>=b)){var c=$("#EditCategory").val(),d=$.trim($("#EditDescription").val());d=d.substr(0,200);var f=$.trim($("#EditTagList").val());f=f.substr(0,100);var g=$("#EditPublish").val(),e=$("#EditPassword").val(),k=$("#OptionRecent").prop("checked")?1:0,n=$("#OptionTweet").prop("checked")?1:0,h=$("#OptionImage").prop("checked")?1:0,m=null,l=$("#EditTimeLimitedStart").val(),q=$("#EditTimeLimitedEnd").val();
10==g&&(m=$("#EditTwitterList").val());if(11!=g||checkPublishDatetime(l,q,!1))return setTweetSetting($("#OptionTweet").prop("checked")),setTweetImageSetting($("#OptionImage").prop("checked")),setLastCategorySetting(c),99==g&&(k=2,n=0),startMsg(),$.ajaxSingle({type:"post",data:{UID:a,CAT:c,DES:d,TAG:f,PID:g,PPW:e,PLD:m,PST:l,PED:q,ED:1},url:"/f/UploadFileRefTwitterF.jsp",dataType:"json",success:function(b){console.log("UploadFileReferenceF",b.content_id);var c=!0;$(".imgView").each(function(){$(this).parent().addClass("Done");
var d=$(this).attr("src").replace("data:image/png;base64,","");if(0>=d.length)return!0;c?(c=!1,$.ajax({type:"post",data:{UID:a,IID:b.content_id,REC:k,DATA:d},url:"/f/UploadPasteFirstF.jsp",dataType:"json",async:!1,success:function(a){console.log("UploadPasteFirstF")}})):$.ajax({type:"post",data:{UID:a,IID:b.content_id,DATA:d},url:"/f/UploadPasteAppendF.jsp",dataType:"json",async:!1,success:function(a){console.log("UploadPasteAppendF")}})});1==n?$.ajax({type:"post",data:{UID:a,IID:b.content_id,IMG:h},
url:"/f/UploadFileTweetF.jsp",dataType:"json",success:function(a){console.log("UploadFileTweetF");completeMsg();setTimeout(function(){location.href="/MyHomePcV.jsp"},1E3)}}):setTimeout(function(){location.href="/MyHomePcV.jsp"},1E3)}}),!1}};
